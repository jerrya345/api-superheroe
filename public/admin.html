<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Panel de Administraci√≥n</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-header {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header h2 {
            margin: 0;
        }
        
        .admin-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .nav-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-btn.active {
            background: #667eea;
            color: white;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .admin-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            font-size: 0.9rem;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #333;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="admin-header">
            <div>
                <h2>üîß Panel de Administraci√≥n</h2>
                <p>Gestiona usuarios y mascotas del sistema</p>
            </div>
            <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>

        <div class="admin-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-btn" onclick="showSection('users')">üë• Usuarios</button>
            <button class="nav-btn" onclick="showSection('pets')">üêæ Mascotas</button>
            <button class="nav-btn" onclick="showSection('heroes')">ü¶∏‚Äç‚ôÇÔ∏è Superh√©roes</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="admin-section">
            <h3>üìä Estad√≠sticas del Sistema</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">-</div>
                    <div class="stat-label">Usuarios Registrados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPets">-</div>
                    <div class="stat-label">Mascotas Creadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalHeroes">-</div>
                    <div class="stat-label">Superh√©roes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeUsers">-</div>
                    <div class="stat-label">Usuarios Activos</div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="users" class="admin-section" style="display: none;">
            <h3>üë• Gesti√≥n de Usuarios</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Email</th>
                        <th>Rol</th>
                        <th>Fecha Registro</th>
                        <th>√öltimo Login</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- Los usuarios se cargar√°n aqu√≠ -->
                </tbody>
            </table>
        </div>

        <!-- Pets Section -->
        <div id="pets" class="admin-section" style="display: none;">
            <h3>üêæ Gesti√≥n de Mascotas</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Usuario</th>
                        <th>Energ√≠a</th>
                        <th>Sue√±o</th>
                        <th>Diversi√≥n</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="petsTableBody">
                    <!-- Las mascotas se cargar√°n aqu√≠ -->
                </tbody>
            </table>
        </div>

        <!-- Heroes Section -->
        <div id="heroes" class="admin-section" style="display: none;">
            <h3>ü¶∏‚Äç‚ôÇÔ∏è Gesti√≥n de Superh√©roes</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Poder</th>
                        <th>Ciudad</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="heroesTableBody">
                    <!-- Los superh√©roes se cargar√°n aqu√≠ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'https://api-superheroe.onrender.com/api';
        let currentUser = null;

        // Verificar autenticaci√≥n y rol de admin
        window.addEventListener('load', () => {
            const user = localStorage.getItem('user');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(user);
            if (currentUser.role !== 'admin') {
                alert('Acceso denegado. Solo administradores pueden acceder a esta p√°gina.');
                window.location.href = 'pets.html';
                return;
            }

            loadDashboardData();
        });

        function showSection(sectionName) {
            // Ocultar todas las secciones
            document.querySelectorAll('.admin-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionName).style.display = 'block';
            
            // Actualizar botones de navegaci√≥n
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Cargar datos seg√∫n la secci√≥n
            switch(sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'pets':
                    loadPets();
                    break;
                case 'heroes':
                    loadHeroes();
                    break;
            }
        }

        async function loadDashboardData() {
            try {
                // Cargar estad√≠sticas
                const [usersResponse, petsResponse, heroesResponse] = await Promise.all([
                    fetch(`${API_URL}/auth/users`),
                    fetch(`${API_URL}/pets`),
                    fetch(`${API_URL}/heroes`)
                ]);

                const users = await usersResponse.json();
                const pets = await petsResponse.json();
                const heroes = await heroesResponse.json();

                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('totalPets').textContent = pets.length;
                document.getElementById('totalHeroes').textContent = heroes.length;
                
                // Usuarios activos (con login reciente)
                const activeUsers = users.filter(user => 
                    user.lastLogin && new Date(user.lastLogin) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000)
                ).length;
                document.getElementById('activeUsers').textContent = activeUsers;

            } catch (error) {
                console.error('Error cargando dashboard:', error);
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch(`${API_URL}/auth/users`);
                const users = await response.json();

                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td><span style="color: ${user.role === 'admin' ? '#dc3545' : '#28a745'}">${user.role}</span></td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Nunca'}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editUser(${user.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteUser(${user.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error cargando usuarios:', error);
            }
        }

        async function loadPets() {
            try {
                const response = await fetch(`${API_URL}/pets`);
                const pets = await response.json();

                const tbody = document.getElementById('petsTableBody');
                tbody.innerHTML = pets.map(pet => `
                    <tr>
                        <td>${pet.id}</td>
                        <td>${pet.name} ${pet.sprite}</td>
                        <td>${pet.type}</td>
                        <td>${pet.userId}</td>
                        <td>${pet.energy}%</td>
                        <td>${pet.sleep}%</td>
                        <td>${pet.fun}%</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editPet(${pet.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deletePet(${pet.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error cargando mascotas:', error);
            }
        }

        async function loadHeroes() {
            try {
                const response = await fetch(`${API_URL}/heroes`);
                const heroes = await response.json();

                const tbody = document.getElementById('heroesTableBody');
                tbody.innerHTML = heroes.map(hero => `
                    <tr>
                        <td>${hero.id}</td>
                        <td>${hero.name}</td>
                        <td>${hero.power}</td>
                        <td>${hero.city}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editHero(${hero.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete-btn" onclick="deleteHero(${hero.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');

            } catch (error) {
                console.error('Error cargando superh√©roes:', error);
            }
        }

        function editUser(userId) {
            alert(`Editar usuario ${userId} - Funci√≥n en desarrollo`);
        }

        function deleteUser(userId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este usuario?')) {
                alert(`Eliminar usuario ${userId} - Funci√≥n en desarrollo`);
            }
        }

        function editPet(petId) {
            alert(`Editar mascota ${petId} - Funci√≥n en desarrollo`);
        }

        function deletePet(petId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar esta mascota?')) {
                alert(`Eliminar mascota ${petId} - Funci√≥n en desarrollo`);
            }
        }

        function editHero(heroId) {
            alert(`Editar superh√©roe ${heroId} - Funci√≥n en desarrollo`);
        }

        function deleteHero(heroId) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este superh√©roe?')) {
                alert(`Eliminar superh√©roe ${heroId} - Funci√≥n en desarrollo`);
            }
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html> 